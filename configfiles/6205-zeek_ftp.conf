# SOF-ELKÂ® Configuration File
# (C)2023 Lewes Technology Consulting, LLC
#
# This file contains processing steps for Zeek's ftp.log

# Reference: https://docs.zeek.org/en/master/scripts/base/protocols/ftp/info.zeek.html#type-FTP::Info

filter {
  if [type] == "zeek_ftp" and "zeek_json" in [tags] {
    mutate {
      rename => {
        "[raw][uid]" => "zeek_uid"
        "[raw][id.orig_h]" => "source_ip"
        "[raw][id.orig_p]" => "source_port"
        "[raw][id.resp_h]" => "destination_ip"
        "[raw][id.resp_p]" => "destination_port"
        "[raw][user]" => "username"
        "[raw][password]" => "password"
        "[raw][command]" => "ftp_command"
        "[raw][arg]" => "ftp_argument"
        "[raw][mime_type]" => "mime_type"
xxxx        "[raw][file_size]" => "xxxxxx" bytes? something ftp-specific??
        "[raw][reply_code]" => "response_code"
        "[raw][reply_msg]" => "response_msg"
        "[raw][data_channel.passive]" => "ftp_data_is_passive"
        "[raw][data_channel.orig_h]" => "ftp_data_source_ip"
        "[raw][data_channel.resp_h]" => "ftp_data_destination_ip"
        "[raw][data_channel.resp_p]" => "ftp_data_destination_port"
        "[raw][cwd]" => "ftp_cwd"
        "[raw][cmdarg]" => "ftp_cmdarg"
        "[raw][pending_commands]" => "ftp_pending_commands"
        "[raw][command_seq]" => "ftp_command_sequence_number"
        "[raw][passive]" => "ftp_is_passive" # unsure how this differs from data_channel.passive, above
        "[raw][fuid]" => "fuid"
      }
    }

    # populate the @timestamp field with the ts value
    date {
      match => [ "[raw][ts]", "UNIX" ]
    }

    mutate {
      convert => {
xxxx        "whatever_file_size_becomes" => "integer" todo
        "response_code" => "integer"
        "ftp_command_sequence_number" => "integer"
      }
      remove_field => "raw"
    }
  }
}
