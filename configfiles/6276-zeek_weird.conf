# SOF-ELKÂ® Configuration File
# (C)2023 Lewes Technology Consulting, LLC
#
# This file contains processing steps for Zeek's weird.log

# Reference: https://docs.zeek.org/en/master/scripts/base/frameworks/notice/weird.zeek.html#type-Weird::Info

filter {
  if [type] == "zeek_weird" and "zeek_json" in [tags] {
    mutate {
      # unsure how passive differs from data_channel.passive
      rename => {
        "[raw][uid]" => "zeek_uid"
        "[raw][id.orig_h]" => "[source][ip]"
        "[raw][id.orig_p]" => "[source][port]"
        "[raw][id.resp_h]" => "[destination][ip]"
        "[raw][id.resp_p]" => "[destination][port]"
        "[raw][name]" => "weird_name"
        "[raw][addl]" => "weird_additional_info"
        "[raw][notice]" => "weird_notice"
        "[raw][peer]" => "zeek_peer_name"
        "[raw][source]" => "weird_source"
        "[raw][identifier]" => "weird_identifier"
      }
    }

    # populate the @timestamp field with the ts value
    date {
      match => [ "[raw][ts]", "UNIX" ]
    }

    mutate {
      remove_field => "raw"
    }
  }
}
