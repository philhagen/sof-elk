# SOF-ELKÂ® Configuration File
# (C)2023 Lewes Technology Consulting, LLC
#
# This file contains processing steps for Zeek's sel.log

# Reference: https://docs.zeek.org/en/master/scripts/base/protocols/ssl/main.zeek.html#type-SSL::Info

filter {
  if [type] == "zeek_ssl" {
    if "zeek_json" in [tags] {
      mutate {
        rename => {
          "[raw][uid]" => "zeek_uid"
          "[raw][id.orig_h]" => "source_ip"
          "[raw][id.orig_p]" => "source_port"
          "[raw][id.resp_h]" => "destination_ip"
          "[raw][id.resp_p]" => "destination_port"
          "[raw][version]" => "ssl_version"
          "[raw][cipher]" => "ssl_cipher"
          "[raw][curve]" => "ssl_elliptic_curve"
          "[raw][server_name]" => "ssl_sni"
          "[raw][resumed]" => "ssl_resumed"
          "[raw][next_protocol]" => "payload_protocol"
          "[raw][established]" => "ssl_established"
          "[raw][logged]" => "ssl_already_logged"
          "[raw][ssl_history]" => "ssl_history"
          "[raw][cert_chain]" => "ssl_cert_chain"
          "[raw][cert_chain_fps]" => "ssl_cert_chain_fps"
          "[raw][client_cert_chain]" => "ssl_client_cert_chain"
          "[raw][client_cert_chain_fps]" => "ssl_client_cert_chain_fps"
          "[raw][subject]" => "ssl_subject"
          "[raw][issuer]" => "ssl_issuer"
          "[raw][client_subject]" => "ssl_client_subject"
          "[raw][client_issuer]" => "ssl_client_issuer"
          "[raw][sni_matches_cert]" => "ssl_sni_matches_cert"
        }
      }

      # populate the @timestamp field with the ts value
      date {
        match => [ "[raw][ts]", "UNIX" ]
      }

      mutate {
        remove_field => "raw"
      }
    }
  }
}
